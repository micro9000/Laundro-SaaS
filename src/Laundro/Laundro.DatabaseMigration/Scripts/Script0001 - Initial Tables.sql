CREATE TABLE ScriptVersion
(
	Hash VARCHAR(64) NOT NULL
)

CREATE TABLE Roles
(
	Id INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	Name VARCHAR(255) NOT NULL,
	SystemKey VARCHAR(100) NOT NULL
)

CREATE TABLE Users
(
	Id INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	Email VARCHAR(255) NOT NULL,
	[Name] VARCHAR(255) NOT NULL,
	RoleId INT NOT NULL,
	CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
	IsActive BIT NOT NULL DEFAULT 1,
	DeActivatedOn DATETIME2 NULL,
	CONSTRAINT FK_Role FOREIGN KEY (RoleId) REFERENCES Roles(Id)
)
CREATE UNIQUE  NONCLUSTERED INDEX IX_Users_Email_RoleId_IsActive
ON Users (Email, RoleId, IsActive);


CREATE TABLE Tenants
(
	Id INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	TenantName VARCHAR(255),
	TenantGuid UNIQUEIDENTIFIER NOT NULL,
	OwnerId INT NOT NULL,
	CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
	IsActive BIT NOT NULL DEFAULT 1,
	DeActivatedOn DATETIME2 NULL,
	CONSTRAINT FK_Owner FOREIGN KEY (OwnerId) REFERENCES Users(Id)
)

CREATE TABLE Stores
(
	Id INT NOT NULL IDENTITY(1,1) PRIMARY KEY,
	TenantId INT NOT NULL,
	Name VARCHAR(255) NOT NULL,
	CreatedAt DATETIME2 DEFAULT SYSDATETIME(),
	IsActive BIT NOT NULL DEFAULT 1,
	DeActivatedOn DATETIME2 NULL,
	CONSTRAINT FK_Tenant FOREIGN KEY (TenantId) REFERENCES Tenants(Id)
)

CREATE TABLE StoreUsers
(
	UserId INT NOT NULL,
	StoreId INT NOT NULL,
	RoleId INT NOT NULL,
	IsActive BIT NOT NULL DEFAULT 1,
	DeActivatedOn DATETIME2 NULL,
	CONSTRAINT PK_StoreUser PRIMARY KEY(UserId, StoreId),
	CONSTRAINT FK_StoreUser_User FOREIGN KEY (UserId) REFERENCES Users(Id),
	CONSTRAINT FK_StoreUser_Store FOREIGN KEY (StoreId) REFERENCES Stores(Id),
	CONSTRAINT FK_StoreUser_Role FOREIGN KEY (RoleId) REFERENCES Roles(Id)
)
